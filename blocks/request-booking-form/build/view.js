(()=>{"use strict";var e={87(e){e.exports=window.wp.element},455(e){e.exports=window.wp.apiFetch},609(e){e.exports=window.React},650(e,t,r){r.d(t,{A:()=>c});var a=r(609),n=r.n(a),o=r(455),i=r.n(o),s=r(790);const l=()=>({id:Math.random().toString(36).substr(2,9),name:"",breed:"",age:"",weight:"",notes:""}),d=({label:e,info:t,inputId:r,children:n,error:o,showError:i})=>{const[l,d]=(0,a.useState)(!1);return(0,s.jsxs)("div",{className:"mhhc-form-group",children:[(0,s.jsx)("label",{htmlFor:r,className:"mhhc-label",children:e}),(0,s.jsxs)("div",{className:"mhhc-input-row",children:[(0,s.jsx)("div",{className:"mhhc-input-control",children:n}),(0,s.jsx)("button",{type:"button",className:"mhhc-info-icon","aria-expanded":l,"aria-controls":`${r}-help`,onClick:()=>d(e=>!e),title:"Hvorfor er dette påkrævet?",tabIndex:-1,children:"❓"})]}),l&&(0,s.jsx)("div",{id:`${r}-help`,className:"mhhc-help-text",role:"note",children:t}),i&&o&&(0,s.jsx)("div",{className:"mhhc-field-error",children:o})]})},c=()=>{const[e,t]=(0,a.useState)(""),[r,o]=(0,a.useState)(""),[c,h]=(0,a.useState)(""),[u,g]=(0,a.useState)(""),[m,p]=(0,a.useState)([l()]),[v,f]=(0,a.useState)(!1),[b,x]=(0,a.useState)([]),[j,_]=(0,a.useState)([]),[k,w]=(0,a.useState)(null),[D,N]=(0,a.useState)(2),[y,S]=(0,a.useState)({}),[$,T]=(0,a.useState)(!1),[F,C]=(0,a.useState)(""),[A,E]=(0,a.useState)(null),[V,I]=(0,a.useState)(250),[R,M]=(0,a.useState)(200),[O,P]=(0,a.useState)([]),[B,H]=(0,a.useState)(!1),U=e=>{if(!e)return null;const[t,r,a]=e.split("-").map(Number);return new Date(t,r-1,a)},J=e=>e?[e.getFullYear(),String(e.getMonth()+1).padStart(2,"0"),String(e.getDate()).padStart(2,"0")].join("-"):"";(0,a.useEffect)(()=>{i()({path:"/wddp_api/config"}).then(e=>{Array.isArray(e?.slots)&&x(e.slots),Array.isArray(e?.closedPeriods)&&_(e.closedPeriods),e?.today&&w(e.today),e?.maxDogs&&N(e.maxDogs),e?.prices&&(Number.isFinite(+e.prices.dog1)&&I(Number(e.prices.dog1)),Number.isFinite(+e.prices.dog2)&&M(Number(e.prices.dog2)),Array.isArray(e.prices.special)&&P(e.prices.special))}).catch(e=>{console.error("Fejl ved hentning af config:",e)})},[]);const L=(t=e,a=r)=>{const n={},o=k?U(k):new Date,i=(e=>{const t=new Date(e.getFullYear(),e.getMonth(),e.getDate());return t.setDate(t.getDate()+1),t})(new Date(o.getFullYear(),o.getMonth(),o.getDate())),s=t?U(t):null,l=a?U(a):null;return s&&s<i&&(n.fromDate=`Datoer skal være tidligst ${J(i)} (i morgen).`),l&&l<i&&(n.toDate=`Datoer skal være tidligst ${J(i)} (i morgen).`),s&&l&&s>l&&(n.fromDate="Fra-dato skal være før eller samme dag som Til-dato.",n.toDate="Til-dato skal være efter eller samme dag som Fra-dato."),s&&l&&!n.fromDate&&!n.toDate&&j.some(e=>{const t=U(e.from),r=U(e.to);return t&&r&&(s<=r&&t<=l)})&&(n.fromDate="De valgte datoer overlapper en lukket periode.",n.toDate="De valgte datoer overlapper en lukket periode."),n};(0,a.useEffect)(()=>{const e=L();S(t=>{const{fromDate:r,toDate:a,...n}=t;return{...n,...e}})},[e,r,k,j]),(0,a.useMemo)(()=>(Array.isArray(O)?O:[]).map(e=>{const t=U(e.from),r=U(e.to);if(!t||!r)return null;const a=J(t<=r?t:r),n=J(t<=r?r:t),o=Number(e.dog1),i=Number(e.dog2);return{from:a,to:n,dog1:Number.isFinite(o)?o:V,dog2:Number.isFinite(i)?i:R}}).filter(Boolean),[O,V,R]),Number.isFinite(V)&&Number.isFinite(R),(0,a.useMemo)(()=>{if(!e||!r)return!1;const t=L(e,r);return!t.fromDate&&!t.toDate},[e,r,k,JSON.stringify(j)]);const Y=n().useCallback(async()=>{if(e&&r)try{const t={fromDate:e,toDate:r,dogsCount:m.length},a=await i()({path:"/wddp_api/calculatePrice",method:"POST",data:t});a&&void 0!==a.total&&(E(a.total),C(""))}catch(e){E(null),C(e?.message||"Kunne ikke beregne prisen.")}else E(null)},[e,r,m.length]);(0,a.useEffect)(()=>{Y()},[Y]);const K=(0,a.useCallback)((e,t,r)=>{p(a=>{const n=[...a];return n[e]={...n[e],[t]:r},n})},[]),X=e=>""===e||null===e||Number.isNaN(Number(e)),q=(e,t=!1)=>!!y[e]&&(!!t||$);return(0,s.jsxs)("div",{className:"mhhc-booking-form",children:[(0,s.jsx)("h2",{children:"Book en plads i hundepensionen test"}),(0,s.jsxs)("div",{className:"mhhc-form-grid",children:[(0,s.jsx)(d,{label:"Fra dato",info:"Vi skal kende perioden for at reservere plads og beregne prisen.",inputId:"fromDate",error:y.fromDate,showError:q("fromDate",!0),children:(0,s.jsx)("input",{id:"fromDate",type:"date",value:e,onChange:e=>t(e.target.value)})}),(0,s.jsx)(d,{label:"Til dato",info:"Vi skal kende perioden for at reservere plads og beregne prisen.",inputId:"toDate",error:y.toDate,showError:q("toDate",!0),children:(0,s.jsx)("input",{id:"toDate",type:"date",value:r,onChange:e=>o(e.target.value)})})]}),(0,s.jsxs)("div",{className:"mhhc-form-grid",children:[(0,s.jsx)(d,{label:"Afleveringstidspunkt",info:"Hundepensionen har kun åbent for aflevering i bestemte perioder for at skabe ro.",inputId:"arrivalTime",error:y.arrivalTime,showError:q("arrivalTime",!0),children:(0,s.jsxs)("select",{id:"arrivalTime",value:c,onChange:e=>h(e.target.value),children:[(0,s.jsx)("option",{value:"",children:"Vælg tidspunkt"}),b.map((e,t)=>(0,s.jsx)("option",{value:e,children:e},t))]})}),(0,s.jsx)(d,{label:"Afhentningstidspunkt",info:"Hundepensionen har kun åbent for afhentning i bestemte perioder for at skabe ro.",inputId:"departureTime",error:y.departureTime,showError:q("departureTime",!0),children:(0,s.jsxs)("select",{id:"departureTime",value:u,onChange:e=>g(e.target.value),children:[(0,s.jsx)("option",{value:"",children:"Vælg tidspunkt"}),b.map((e,t)=>(0,s.jsx)("option",{value:e,children:e},t))]})})]}),(0,s.jsx)("hr",{}),m.map((e,t)=>(0,s.jsxs)("div",{className:"mhhc-dog-fields",children:[(0,s.jsxs)("h3",{children:["Hund ",t+1]}),(0,s.jsxs)("div",{className:"mhhc-form-grid",children:[(0,s.jsx)(d,{label:"Navn",info:"Vi vil gerne kende hundens navn.",inputId:`dog_${t}_name`,error:y[`dog_${t}_name`],showError:q(`dog_${t}_name`),children:(0,s.jsx)("input",{id:`dog_${t}_name`,type:"text",value:e.name,onChange:e=>K(t,"name",e.target.value)})}),(0,s.jsx)(d,{label:"Alder",info:"Alderen kan have betydning for pasning af hunden.",inputId:`dog_${t}_age`,error:y[`dog_${t}_age`],showError:q(`dog_${t}_age`),children:(0,s.jsx)("input",{id:`dog_${t}_age`,text:!0,value:e.age,onChange:e=>K(t,"age",e.target.value)})})]}),(0,s.jsxs)("div",{className:"mhhc-form-grid",children:[(0,s.jsx)(d,{label:"Race",info:"Race kan påvirke hvor meget plads din hund har behov for.",inputId:`dog_${t}_breed`,error:y[`dog_${t}_breed`],showError:q(`dog_${t}_breed`),children:(0,s.jsx)("input",{id:`dog_${t}_breed`,type:"text",value:e.breed,onChange:e=>K(t,"breed",e.target.value)})}),(0,s.jsx)(d,{label:"Vægt (kg)",info:"Vægt kan påvirke foder og håndtering.",inputId:`dog_${t}_weight`,error:y[`dog_${t}_weight`],showError:q(`dog_${t}_weight`),children:(0,s.jsx)("input",{id:`dog_${t}_weight`,type:"number",step:"0.1",min:"0",value:e.weight,onChange:e=>K(t,"weight",e.target.value)})})]}),(0,s.jsxs)("div",{className:"mhhc-form-group",children:[(0,s.jsx)("label",{htmlFor:`dog_${t}_notes`,children:"Anmærkninger"}),(0,s.jsx)("textarea",{id:`dog_${t}_notes`,value:e.notes,onChange:e=>K(t,"notes",e.target.value)})]})]},e.id)),(0,s.jsxs)("div",{className:"mhhc-form-buttons",children:[m.length<D&&(0,s.jsx)("button",{type:"button",onClick:()=>{console.log(D),m.length<=D&&p(e=>[...e,l()])},children:"➕ Tilføj hund"}),m.length>1&&(0,s.jsx)("button",{type:"button",onClick:()=>(e=>{if(m.length>1){const t=[...m];t.splice(e,1),p(t)}})(m.length-1),children:"➖ Fjern sidste hund"})]}),(0,s.jsx)("hr",{}),(0,s.jsxs)("div",{className:"mhhc-form-group",children:[(0,s.jsxs)("label",{children:[(0,s.jsx)("input",{type:"checkbox",checked:v,onChange:e=>f(e.target.checked)}),"Jeg har læst og accepteret betingelserne"]}),q("acceptTerms")&&(0,s.jsx)("div",{className:"mhhc-field-error",children:y.acceptTerms})]}),F&&(0,s.jsx)("div",{className:"mhhc-form-message",children:F}),(0,s.jsx)("div",{className:"mhhc-price-box",children:null!==A?(0,s.jsxs)("strong",{children:["Forventet pris: ",A," kr."]}):(0,s.jsx)("span",{children:"Udfyld formularen for at se pris"})}),(0,s.jsx)("div",{className:"mhhc-submit-wrapper",children:(0,s.jsx)("button",{type:"button",onClick:async()=>{const t={...L(e,r)};e||t.fromDate||(t.fromDate="Vælg en fra-dato."),r||t.toDate||(t.toDate="Vælg en til-dato."),c||(t.arrivalTime="Vælg afleverings-tidspunkt."),u||(t.departureTime="Vælg afhentnings-tidspunkt."),c&&!b.includes(c)&&(t.arrivalTime="Ugyldigt tidspunkt."),u&&!b.includes(u)&&(t.departureTime="Ugyldigt tidspunkt.");const a=m[0]||l();if(a.name.trim()||(t.dog_0_name="Navn er påkrævet."),a.breed.trim()||(t.dog_0_breed="Race er påkrævet."),a.age.trim()||(t.dog_0_age="Alder er påkrævet."),X(a.weight)&&(t.dog_0_weight="Vægt er påkrævet."),m.forEach((e,r)=>{e.name.trim()||(t[`dog_${r}_name`]="Navn er påkrævet."),e.breed.trim()||(t[`dog_${r}_breed`]="Race er påkrævet."),e.age&&e.age.trim()||(t[`dog_${r}_age`]="Alder er påkrævet."),X(e.weight)&&(t[`dog_${r}_weight`]="Vægt er påkrævet.")}),v||(t.acceptTerms="Du skal acceptere betingelserne."),S(t),Object.values(t).some(Boolean))C("Ret venligst fejlene i formularen.");else try{H(!0),T(!0),C("Formularen er klar til at blive sendt! ✅"),await(async()=>{try{const t=await i()({path:"/wddp_api/create_booking",method:"POST",data:{from_date:e,to_date:r,arrival_time:c,departure_time:u,price:A,dogs:m}});t.redirect?window.location.href=t.redirect:C("Fejl: Manglende redirect URL")}catch(e){console.error(e),C("Der opstod en fejl ved oprettelse.")}})()}catch(e){}finally{H(!1)}},disabled:B,children:"Book nu"})})]})}},790(e){e.exports=window.ReactJSXRuntime}},t={};function r(a){var n=t[a];if(void 0!==n)return n.exports;var o=t[a]={exports:{}};return e[a](o,o.exports,r),o.exports}r.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return r.d(t,{a:t}),t},r.d=(e,t)=>{for(var a in t)r.o(t,a)&&!r.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})},r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r(609);var a=r(87),n=r(650),o=r(790);document.addEventListener("DOMContentLoaded",()=>{const e=document.getElementById("mhhc_hundepension_form");e&&(0,a.createRoot)(e).render((0,o.jsx)(n.A,{}))})})();
//# sourceMappingURL=view.js.map